{% doc %}
  Product variant items snippet
  
  Renders product variants as individual product items, with optional filtering by color.

  @param {object} prod - The product object to display variants for
  @param {object} [filters] - Collection filters, defaults to collection.filters
  @param {number} product_columns_desktop - Number of columns to display on desktop
  @param {number} product_columns_mobile - Number of columns to display on mobile
  @param {string} aspect_ratio - Aspect ratio for the product images [portrait, landscape, square, portrait_alt, landscape_alt, landscape_wide_alt]
  @param {boolean} has_grid_reveal - Whether to enable grid reveal animation
  @param {boolean} [show_price] - Whether to show the price
  @param {boolean} [show_favorite_button] - Whether to show the favorite button
  @param {boolean} [show_unavailable_variants] - Whether to show unavailable variants (default: false)

  @example
  {% render 'product-variant-items',
    prod: product,
    filters: collection.filters,
    product_columns_desktop: 4,
    product_columns_mobile: 1,
    aspect_ratio: 'landscape',
    has_grid_reveal: false,
    show_price: true,
    show_favorite_button: true,
    show_unavailable_variants: false
  %}
{% enddoc %}

<!-- snippets/product-variant-items.liquid -->

{%- liquid
  assign filters = filters | default: collection.filters

  assign show_all_variants = true
  assign selected_colors = ''

  for filter in filters
    if filter.label == 'Color' or filter.label == 'Colour'
      if filter.active_values.size > 0
        assign show_all_variants = false
        assign selected_colors = filter.active_values | map: 'value' | join: ','
      endif
    endif
  endfor

  # Split the selected colors into an array
  assign color_array = selected_colors | split: ','

  assign show_unavailable_variants = show_unavailable_variants | default: false
-%}

{% for variant in prod.variants %}
  {%- liquid
    assign show_variant = false
    if show_all_variants
      assign show_variant = true
    else
      # Check if any variant option matches any selected color
      for color in color_array
        if variant.option1 == color or variant.option2 == color or variant.option3 == color
          assign show_variant = true
          break
        endif
      endfor
    endif

    if variant.available == false and show_unavailable_variants != true
      assign show_variant = false
    endif

    if show_variant == false
      continue
    endif
  -%}

  {% render 'product-item',
    prod: prod,
    var: variant,
    product_columns_desktop: product_columns_desktop,
    product_columns_mobile: product_columns_mobile,
    aspect_ratio: aspect_ratio,
    has_grid_reveal: has_grid_reveal,
    show_favorite_button: show_favorite_button,
    show_price: show_price
  %}
{% endfor %}
