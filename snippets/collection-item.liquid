{% doc %}
  Renders a collection item card with image, title, and optional button

  @param {object} collection - Collection object to display (required)
  @param {string} label_style - Style for the label: 'overlay' or other (required)
  @param {string} overlay_title_background - Color picker value for overlay background (required)
  @param {string} overlay_title_background_style - Style for overlay background (required)
  @param {string} image_sizes - Sizes attribute for responsive images (required)
  @param {string} [aspect_ratio] - Aspect ratio for the image
  @param {boolean} [placeholder] - Show placeholder content if true

  @example
  Basic collection item
  {% render 'collection-item', collection: collections.featured, label_style: 'overlay', overlay_title_background: '#000000', overlay_title_background_style: 'solid', image_sizes: '(min-width: 768px) 50vw, 100vw' %}
  @example
  With custom aspect ratio
  {% render 'collection-item', collection: collections.men, label_style: 'below', overlay_title_background: '#ffffff', overlay_title_background_style: 'gradient', image_sizes: '300px', aspect_ratio: 'portrait' %}
{% enddoc %}

{%- liquid
  assign label_is_overlay = false

  if label_style == 'overlay'
    assign label_is_overlay = true
  endif

  assign title = collection.metafields.custom.short_name | default: collection.title

  assign button_id = 'button-' | append: collection.id | append: '-' | append: section.id
-%}
{% capture collection_label %}
  <div class="collection-item__label">
    <div class="collection-item__title md:pb-4">
      {%- if label_is_overlay -%}
      <h4 class="md:text-2xl text-xl uppercase text-center mb-4 ff-heading">
          {%- if placeholder -%}
            {{ 'collections.general.collection_label' | t }}
          {%- else -%}
            {{ title }}
          {%- endif -%}
        </h4>
        {%- if section.settings.button_text != blank -%}

            {%- style -%}
                #{{ button_id }} {
                  {%- render 'button-style', settings_object: section.settings, settings_key: 'button' -%}
                }

                @media (max-width: 768px) {

                  #{{ button_id }} {
                    {%- render 'button-style', settings_object: section.settings, settings_key: 'button_mobile' -%}
                  }
              {%- endstyle -%}
            <div
              id="{{ button_id }}"
              class="btn btn--overlay 
              {{ section.settings.button_style }}{% if use_small_button_above_960 %} btn--small-above-960{% endif %}
              w-fit mx-auto 
              "
            >
              <span>{{ section.settings.button_text }}</span>
            </div>
        {%- endif -%}
      {%- else -%}
        <h4>
          {%- if placeholder -%}
            {{ 'collections.general.collection_label' | t }}
          {%- else -%}
            <a href="{{ collection.url }}">{{ collection.title }}</a>
          {%- endif -%}
        </h4>
      {%- endif -%}
    </div>
  </div>
{% endcapture %}

<div
  class="
    collection-item
    collection-item--label-{{ label_style }}
    collection-item--label-background-{{ overlay_title_background_style }}
    animation--item
  "
  style="
    --overlay-text-color: {{ section.settings.overlay_text_color }};
    --label-background: {{ overlay_title_background }};
    --label-gradient-start: {{ overlay_title_background | color_modify: 'alpha', 0.4 }};
    --label-gradient-mid: {{ overlay_title_background | color_modify: 'alpha', 0.2 }};
    --label-gradient-end: {{ overlay_title_background | color_modify: 'alpha', 0 }};
  "
>
  {%- capture wrapping_tag -%}
    {%- if include_placeholder -%}div{%- else -%}a{%- endif -%}
  {%- endcapture -%}
  {%- capture wrapping_attributes -%}
    {%- unless include_placeholder -%}href="{{ collection.url }}" aria-label="{{ collection.title }}"{%- endunless -%}
  {%- endcapture -%}
  <{{ wrapping_tag }}
    {{ wrapping_attributes }}
    class="collection-item__image-wrapper hover"
  >
    {%
      render 'legacy-image' with
      image: collection.featured_image,
      wrapper_class: 'collection-item__image',
      aspect_ratio: aspect_ratio,
      placeholder_name: 'collection-1',
      include_placeholder: true,
      sizes: image_sizes,
      src_set_type: "grid"
    %}

    {%- if label_is_overlay -%}
      {{ collection_label }}
    {%- endif -%}
  </{{ wrapping_tag }}>

  {%- unless label_is_overlay -%}
    {{ collection_label }}
  {%- endunless -%}
</div>
