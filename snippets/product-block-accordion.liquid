{% doc %}
  Renders an accordion block for product pages with collapsible content

  @param {object} [block] - Section block with settings and attributes
  @param {object} [block_settings] - Block settings object
  @param {string} heading - Accordion heading text (required)
  @param {string} content - Accordion content (required)
  @param {boolean} [expand_by_default] - Whether accordion should be open by default
  @param {string} [label_font] - Font family class for the heading
  @param {string} [label_font_size] - Font size class for the heading (default: 'text-[18px]')
  @param {string} [classes] - Additional CSS classes
  @param {boolean} [disable_rte] - Disable rich text editor styling

  @example
  Basic accordion
  {% render 'product-block-accordion', heading: 'Product Details', content: product.description, block: block %}
  @example
  With custom styling
  {% render 'product-block-accordion', heading: 'Shipping Info', content: 'Free shipping details', expand_by_default: true, label_font: 'font-bold' %}
{% enddoc %}

{%- liquid
  assign open = false
  if block_settings.expand_by_default or expand_by_default
    assign open = true
  endif

  # Note: these two classes must also be applied to the icon wrapper for vertical alignment

  unless label_font
    assign label_font = ''
  endunless
  unless label_font_size
    assign label_font_size = 'text-[18px]'
  endunless

  if block_settings.page_for_content
    assign content_page = pages[block_settings.page_for_content]

    if content_page and content_page != blank
      assign content = content_page.content
    endif
  endif

  if block_settings.custom_liquid != blank
    assign content = block_settings.custom_liquid
  endif
-%}

{%- if block_settings.fetch_page_content and content_page != blank -%}
  {%- capture content -%}
  <load-page-content
    data-lazy-type="load"
    data-page-url="{{ content_page.url }}"
  ></load-page-content>
  {%- endcapture -%}
{%- endif -%}

{% if content != blank or request.design_mode %}
  <div class="accordion {{ classes }}" {{ block.shopify_attributes }}>
    <div
      class="accordion__inner "
      data-index="{{ forloop.index0 }}"
      data-open="{% if open %}true{% else %}false{% endif %}"
      {{ block.shopify_attributes }}
    >
      <button
        class="accordion__label"
        aria-expanded="{% if open %}true{% else %}false{% endif %}"
        aria-controls="{{ block.id }}"
      >
        {%- liquid
          assign heading_tag = 'h3'
          if block.settings.heading_tag
            assign heading_tag = block.settings.heading_tag
          elsif block.settings.title_tag
            assign heading_tag = block.settings.title_tag
          endif
        -%}
        <{{ heading_tag }} class="{{ label_font }} {{ label_font_size }}">
          {{ heading }}
        </{{ heading_tag }}>
        <div class="accordion__label-icons">
          {% render 'icon', icon: 'chevron' %}
        </div>
      </button>
      <div
        class="accordion__content fs-body-100{% unless disable_rte %} rte non-page-rte{% endunless %}"
        aria-hidden="{% if open %}false{% else %}true{% endif %}"
        {% unless open %}
          style="display: none"
        {% endunless %}
        id="accordion-content-{{ block.id }}"
      >
        {%- render 'force-lazy-content', content: content -%}
      </div>
    </div>
  </div>
{% endif %}
