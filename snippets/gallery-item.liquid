<!-- snippets/gallery-item.liquid -->

{% doc %}
  Renders a gallery item with media, title, and optional text content

  @param {object} block - Current block with settings
  @param {string} title - Title text for the gallery item
  @param {object} media - Media object (image or video)
  @param {string} [text] - Optional text content
  @param {string} [aspect_ratio] - Aspect ratio for the media
  @param {boolean} [enable_lightbox] - Whether to enable lightbox functionality

  @example
  Basic usage
  {% render 'gallery-item',
    block: block,
    title: 'Gallery Title',
    media: block.settings.image
  %}
  @example
  With text and lightbox
  {% render 'gallery-item',
    block: block,
    title: 'Product Feature',
    media: block.settings.video,
    text: 'Detailed description...',
    enable_lightbox: true
  %}
{% enddoc %}

{%- liquid
  if block and media == blank
    assign media = block.settings.image
  endif

  if media.media_type == 'image'
    assign image = media
    assign media_src = media | image_url
    assign media_width = media.width
    assign media_height = media.height

  elsif media.media_type == 'video'
    assign mp4_source = media.sources | where: 'mime_type', 'video/mp4' | first
    assign media_src = mp4_source.url
    assign media_width = mp4_source.width
    assign media_height = mp4_source.height
  endif

  assign title = title | default: metaobject.collection_title.value
  assign image = image | default: metaobject.grid_image.value

  assign label_is_overlay = false

  if label_style == 'overlay'
    assign label_is_overlay = true
  endif
-%}

{% capture item_label %}
  <div class="gallery-item__label {{ label_size }} ff-body">
    {%- if title != blank -%}
      <h4 class="gallery-item__title fs-heading-5-base ff-heading">{{ title }}</h4>
    {% endif %}
    {{ block.settings.text }}
  </div>
{% endcapture %}

<div
  class="
    gallery-item
    gallery-item--label-{{ label_style }}
    gallery-item--label-background-{{ overlay_text_background_style }}
    animation--item
    {{ block.shopify_attributes }}
  "
  style="
    --overlay-text-color: {{ overlay_text_color }};
    --label-background: {{ overlay_text_background }};
    --label-gradient-start: {{ overlay_text_background | color_modify: 'alpha', 0.4 }};
    --label-gradient-mid: {{ overlay_text_background | color_modify: 'alpha', 0.2 }};
    --label-gradient-end: {{ overlay_text_background | color_modify: 'alpha', 0 }};
  "

  {% if media %}
    data-pswp-src="{{ media_src }}"
    data-pswp-width="{{ media_width }}"
    data-pswp-height="{{ media_height }}"
    data-pswp-type="{{ media.media_type }}"
    data-pswp-video="{{ media_src }}"
  {% endif %}
>
  <div class="gallery-item__image-wrapper hover">
    {%- if media.media_type == 'video' -%}
      {{ media | video_tag: image_size: '1024x', autoplay: true, muted: true, loop: true, controls: true }}
    {%- else -%}
      {% render 'legacy-image',
        image: image,
        wrapper_class: 'gallery-item__image',
        aspect_ratio: aspect_ratio,
        focal_point: block.settings.focal_point,
        include_placeholder: true,
        sizes: image_sizes,
        src_set_type: 'grid'
      %}
    {%- endif -%}

    {%- if label_is_overlay -%}
      {{ item_label }}
    {%- endif -%}
  </div>

  {{ item_label }}
</div>
